"use strict";(self.webpackChunkaime_tma=self.webpackChunkaime_tma||[]).push([[3288],{19601:function(pa,ge,t){t.r(ge),t.d(ge,{default:function(){return Ma}});var Re=t(64599),Ze=t.n(Re),We=t(15009),V=t.n(We),be=t(19632),Ve=t.n(be),we=t(99289),oe=t.n(we),ze=t(5574),D=t.n(ze),i=t(67294),L={chatContainer:"chatContainer___roRZO",warning:"warning___Z8pnn",audioPlayer:"audioPlayer___YtRCR",chatWrapper:"chatWrapper___dPdG8",chatHeader:"chatHeader___u5rhw",chatHeaderButtons:"chatHeaderButtons___R6PDz",chatHeaderLeft:"chatHeaderLeft___j3tcw",chatHeaderHome:"chatHeaderHome___KHZsm",chatHeaderHomeIcon:"chatHeaderHomeIcon___hx9iy",chatHeaderRight:"chatHeaderRight___QOycw",chatHeaderButton:"chatHeaderButton___I0F23",chatHeaderAvatar:"chatHeaderAvatar___QngEq",chatHeaderAvatarImg:"chatHeaderAvatarImg___JxOf2",chatHeaderName:"chatHeaderName___YxVfg",chatContent:"chatContent___tCs27",chatInfo:"chatInfo___mlqHx"},He=t(5434),Ye=t(9783),Ue=t.n(Ye),y={inputBoxContainer:"inputBoxContainer___CWHSB",inputBoxWrapper:"inputBoxWrapper___PvH_k",inputBoxWrapperRow:"inputBoxWrapperRow___WspJk",inputBoxWrapperTip:"inputBoxWrapperTip___Jxp46",inputBox:"inputBox___sAqgg",inputBoxSwitch:"inputBoxSwitch___lroHp",inputBoxSwitchIcon:"inputBoxSwitchIcon___og4FU",inputBoxInput:"inputBoxInput___c4Hnw",inputBoxInputInput:"inputBoxInputInput___CI0Ij",inputBoxSend:"inputBoxSend___A9wk1",inputBoxSendIcon:"inputBoxSendIcon___utMME",inputRecordContainer:"inputRecordContainer___FvhJs",inputBoxRecorder:"inputBoxRecorder___JxMlC",inputBoxRecord:"inputBoxRecord___T1GwP",inputBoxRecordActive:"inputBoxRecordActive___vUS9z",inputBoxRecordAnimation:"inputBoxRecordAnimation___M4KvF",buyButton:"buyButton___w1chM"},Ne=t(47516),Ge=t(53854),Oe=t(80471),Te=t(2453),Je=t(69025),m=t(82188),B=t(88594),Se=t(69077),_e=t(45566),fe=t(12174),Fe=t(89583),$e=t(93967),Qe=t.n($e),Pe=t(42968),ye=t(21621),e=t(85893),Xe=function(f){var p,d,o=f.isTextMode,s=f.setIsTextMode,l=f.inputBoxContainer,I=(0,m.useModel)("useSocket"),Q=I.handleSendMessage,W=I.connecting,H=I.SendMessageType,se=(0,m.useModel)("useAccess"),G=se.accessToken,K=se.accessTokenExpire,g=(0,m.useModel)("useWallet"),Y=g.address,X=g.walletBinded,r=(0,m.useModel)("useTelegram"),O=r.telegramDataString,pe=r.telegramAuthType,U=r.miniAppUtils,J=r.telegramWebApp,re=(0,m.useModel)("useChat"),T=re.messageList,ce=(0,m.useModel)("useSetting"),N=ce.character,_=i.useState(),b=D()(_,2),A=b[0],de=b[1],me=i.useState(!1),ue=D()(me,2),q=ue[0],ee=ue[1],ae=i.useState(),ve=D()(ae,2),ne=ve[0],he=ve[1],te=i.useState(0n),S=D()(te,2),w=S[0],a=S[1],C=i.useState(!1),P=D()(C,2),n=P[0],k=P[1],F=(0,Se.mA)(),u=F.isConnected,M=(0,Pe.I)();(0,i.useEffect)(function(){oe()(V()().mark(function j(){var v,x,h;return V()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(!(M.recordingBlob&&!n&&G)){E.next=12;break}return E.next=3,(0,ye.Xd)(M.recordingBlob,G);case 3:if(v=E.sent,x=v.response,h=v.data,!((x==null?void 0:x.status)===200&&h.text)){E.next=11;break}return E.next=9,Q(H.TEXT,h.text);case 9:E.next=12;break;case 11:Te.ZP.error("Please speak again");case 12:case"end":return E.stop()}},j)}))()},[M.recordingBlob,n,G]);var R=(0,Se.do)({address:"0x".concat(B.j9.Optimism.Powers),abi:t(43379),functionName:"powerBalance",args:["0x".concat(N==null||(p=N.wallet)===null||p===void 0?void 0:p.optimism),Y],onSuccess:function(v){a(v??0n)}});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:y.inputBoxContainer,ref:l,children:(0,e.jsxs)("div",{className:y.inputBoxWrapper,children:[!!Y&&(0,e.jsx)("div",{className:y.inputBoxWrapperRow,children:(0,e.jsxs)("div",{className:y.inputBoxWrapperTip,children:["You own ",!!Y&&((d=w==null?void 0:w.toString())!==null&&d!==void 0?d:"0")," Power of ",N==null?void 0:N.name]})}),(0,e.jsxs)("div",{className:y.inputBoxWrapperRow,children:[(0,e.jsx)("div",{className:y.buyButton,onClick:function(){O&&U?U==null||U.openLink("".concat(B.fk===null||B.fk===void 0?void 0:B.fk.url,"/hub?access_token=").concat(G,"&access_token_expire=").concat(K,"&action=trade&characterId=").concat(N==null?void 0:N.id,"&telegramDataString=").concat(encodeURIComponent(O),"&telegramAuthType=").concat(pe)):ee(!0),O&&J&&(J==null||J.close())},children:(0,e.jsx)(Fe.vAr,{})}),(0,e.jsxs)("div",{className:y.inputBox,style:{width:Y&&w===0n?"calc(100% - 55px)":"100%"},children:[!!(T!=null&&T.size)&&(0,e.jsx)("div",{className:y.inputBoxSwitch,onClick:function(){s(!o)},children:o?(0,e.jsx)(Ne.dxk,{className:y.inputBoxSwitchIcon}):(0,e.jsx)(Oe.imB,{className:y.inputBoxSwitchIcon})}),o?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:y.inputBoxInput,children:(0,e.jsx)(Je.Z,{disabled:!(T!=null&&T.size)||W,bordered:!1,placeholder:!(T!=null&&T.size)||W?"Thinking...":"Type something...",className:y.inputBoxInputInput,value:A,onChange:function(v){de(v.target.value)},onKeyDown:function(){var j=oe()(V()().mark(function v(x){return V()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(!(x.key==="Enter"&&A&&(T!=null&&T.size)&&!W)){z.next=4;break}return z.next=3,Q(H.TEXT,A);case 3:de("");case 4:case"end":return z.stop()}},v)}));return function(v){return j.apply(this,arguments)}}()})}),!!(T!=null&&T.size)&&!W&&(0,e.jsx)("div",{className:y.inputBoxSend,onClick:oe()(V()().mark(function j(){return V()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(!A){x.next=4;break}return x.next=3,Q(H.TEXT,A);case 3:de("");case 4:case"end":return x.stop()}},j)})),children:(0,e.jsx)(Ge.WFu,{className:y.inputBoxSendIcon})})]}):(0,e.jsxs)("div",{className:y.inputRecordContainer,onClick:oe()(V()().mark(function j(){return V()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:k(!n),n?M.stopRecording():M.startRecording();case 2:case"end":return x.stop()}},j)})),children:[(0,e.jsx)(Pe.h,{onRecordingComplete:function(v){var x=URL.createObjectURL(v),h=document.createElement("audio");h.src=x,h.controls=!0,document.body.appendChild(h)},audioTrackConstraints:{noiseSuppression:!0,echoCancellation:!0},classes:{AudioRecorderClass:y.inputBoxRecorder}}),(0,e.jsx)("div",{className:Qe()(y.inputBoxRecord,Ue()({},y.inputBoxRecordActive,n)),children:(0,e.jsx)("span",{children:n?"Click to stop":"Click to record"})})]})]})]})]})}),(0,e.jsx)(_e.Z,{visible:q&&(!u||!X),setVisible:function(){ee(!1)}}),(0,e.jsx)(fe.Z,{visible:q&&u&&X,setVisible:ee,transactionHash:ne,setTransactionHash:he})]})},Ke=Xe,c={aiPopContainer:"aiPopContainer___sLU0m",aiPopWrapper:"aiPopWrapper___gbo6r",aiPopText:"aiPopText___Al7D9",aiPopLink:"aiPopLink___c6lBR",aiPopTextIcon:"aiPopTextIcon___vaPTO",aiPopAudio:"aiPopAudio___Nv0Gq",aiPopAudioPlayer:"aiPopAudioPlayer___iCzpn",aiPopAction:"aiPopAction___uoGnh",aiPopButtons:"aiPopButtons___ose7V",aiPopButton:"aiPopButton___OHPbF",aiPopButtonIcon:"aiPopButtonIcon___bWNyR",aiPopButtonDark:"aiPopButtonDark___P73Sh",aiPopWidget:"aiPopWidget___qAhMV",aiPopWidgetForward:"aiPopWidgetForward___eDi9M",aiPopWidgetForwardIcon:"aiPopWidgetForwardIcon___qlGMn"},xe=t(15867),Ie=t(88929),Ce=t(9361),je=t(79352),ie=t(43958),Le=t(95860),qe=Object.defineProperty,Be=Object.getOwnPropertySymbols,ea=Object.prototype.hasOwnProperty,aa=Object.prototype.propertyIsEnumerable,ke=(Z,f,p)=>f in Z?qe(Z,f,{enumerable:!0,configurable:!0,writable:!0,value:p}):Z[f]=p,na=(Z,f)=>{for(var p in f||(f={}))ea.call(f,p)&&ke(Z,p,f[p]);if(Be)for(var p of Be(f))aa.call(f,p)&&ke(Z,p,f[p]);return Z};const Ee=Z=>i.createElement("svg",na({xmlns:"http://www.w3.org/2000/svg",width:230,height:20,fill:"none"},Z),i.createElement("g",{filter:"url(#soundPlay_svg__a)"},i.createElement("circle",{cx:10,cy:10,r:10,fill:"#000"})),i.createElement("path",{d:"M14.25 9.567a.5.5 0 0 1 0 .866l-6 3.464a.5.5 0 0 1-.75-.433V6.536a.5.5 0 0 1 .75-.433l6 3.464Z",fill:"#fff"}),i.createElement("path",{d:"M141.485 6.818h1.712v6.818h-1.712V6.818Zm30.636 0h1.712v6.818h-1.712V6.818Zm25.531 0h1.712v6.818h-1.712V6.818Zm30.636 0H230v6.818h-1.712V6.818ZM177.227 5h1.712v9.546h-1.712V5Zm15.319-.909h1.712v11.364h-1.712V4.09Zm-10.213 3.182h1.713v5.454h-1.713V7.273Zm5.106-.91h1.713v7.728h-1.713V6.364Zm-51.06-2.272h1.712v11.364h-1.712V4.09Zm-5.106 3.182h1.712v5.454h-1.712V7.273ZM146.591 5h1.712v10h-1.712V5Zm20.424 0h1.712v10h-1.712V5Zm35.743 0h1.712v10.455h-1.712V5Zm20.424 0h1.712v10h-1.712V5Zm-71.485-.909h1.712v11.818h-1.712V4.091Zm10.212-.455h1.712v13.182h-1.712V3.636Zm45.955-.454h1.712v13.636h-1.712V3.182Zm10.212 0h1.712v13.636h-1.712V3.182ZM156.803 0h1.712v20h-1.712V0Zm56.167.91h1.712V19.09h-1.712V.909ZM40.212 6.817h1.712v6.818h-1.712V6.818Zm30.636 0h1.713v6.818h-1.713V6.818Zm25.53 0h1.713v6.818h-1.712V6.818Zm30.637 0h1.712v6.818h-1.712V6.818ZM75.955 5h1.712v9.546h-1.713V5Zm15.318-.909h1.712v11.364h-1.712V4.09ZM81.06 7.273h1.712v5.454H81.06V7.273Zm5.105-.91h1.713v7.728h-1.713V6.364Zm-51.06-2.272h1.712v11.364h-1.712V4.09ZM30 7.273h1.712v5.454H30V7.273ZM45.318 5h1.712v10h-1.712V5Zm20.424 0h1.712v10h-1.712V5Zm35.743 0h1.712v10.455h-1.712V5Zm20.424 0h1.712v10h-1.712V5Zm-71.485-.909h1.712v11.818h-1.712V4.091Zm10.212-.455h1.712v13.182h-1.712V3.636Zm45.955-.454h1.712v13.636h-1.712V3.182Zm10.212 0h1.712v13.636h-1.712V3.182ZM55.53 0h1.712v20H55.53V0Zm56.167.91h1.712V19.09h-1.712V.909Z",fill:"#000",fillOpacity:.2}),i.createElement("defs",null,i.createElement("filter",{id:"soundPlay_svg__a",x:-4.444,y:-4.444,width:28.889,height:28.889,filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},i.createElement("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),i.createElement("feGaussianBlur",{in:"BackgroundImageFix",stdDeviation:2.222}),i.createElement("feComposite",{in2:"SourceAlpha",operator:"in",result:"effect1_backgroundBlur_1200_43"}),i.createElement("feBlend",{in:"SourceGraphic",in2:"effect1_backgroundBlur_1200_43",result:"shape"}))));var ma="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMzAiIGhlaWdodD0iMjAiIGZpbGw9Im5vbmUiPjxnIGZpbHRlcj0idXJsKCNhKSI+PGNpcmNsZSBjeD0iMTAiIGN5PSIxMCIgcj0iMTAiIGZpbGw9IiMwMDAiLz48L2c+PHBhdGggZD0iTTE0LjI1IDkuNTY3YS41LjUgMCAwIDEgMCAuODY2bC02IDMuNDY0YS41LjUgMCAwIDEtLjc1LS40MzNWNi41MzZhLjUuNSAwIDAgMSAuNzUtLjQzM2w2IDMuNDY0WiIgZmlsbD0iI2ZmZiIvPjxwYXRoIGQ9Ik0xNDEuNDg1IDYuODE4aDEuNzEydjYuODE4aC0xLjcxMlY2LjgxOFptMzAuNjM2IDBoMS43MTJ2Ni44MThoLTEuNzEyVjYuODE4Wm0yNS41MzEgMGgxLjcxMnY2LjgxOGgtMS43MTJWNi44MThabTMwLjYzNiAwSDIzMHY2LjgxOGgtMS43MTJWNi44MThaTTE3Ny4yMjcgNWgxLjcxMnY5LjU0NmgtMS43MTJWNVptMTUuMzE5LS45MDloMS43MTJ2MTEuMzY0aC0xLjcxMlY0LjA5Wm0tMTAuMjEzIDMuMTgyaDEuNzEzdjUuNDU0aC0xLjcxM1Y3LjI3M1ptNS4xMDYtLjkxaDEuNzEzdjcuNzI4aC0xLjcxM1Y2LjM2NFptLTUxLjA2LTIuMjcyaDEuNzEydjExLjM2NGgtMS43MTJWNC4wOVptLTUuMTA2IDMuMTgyaDEuNzEydjUuNDU0aC0xLjcxMlY3LjI3M1pNMTQ2LjU5MSA1aDEuNzEydjEwaC0xLjcxMlY1Wm0yMC40MjQgMGgxLjcxMnYxMGgtMS43MTJWNVptMzUuNzQzIDBoMS43MTJ2MTAuNDU1aC0xLjcxMlY1Wm0yMC40MjQgMGgxLjcxMnYxMGgtMS43MTJWNVptLTcxLjQ4NS0uOTA5aDEuNzEydjExLjgxOGgtMS43MTJWNC4wOTFabTEwLjIxMi0uNDU1aDEuNzEydjEzLjE4MmgtMS43MTJWMy42MzZabTQ1Ljk1NS0uNDU0aDEuNzEydjEzLjYzNmgtMS43MTJWMy4xODJabTEwLjIxMiAwaDEuNzEydjEzLjYzNmgtMS43MTJWMy4xODJaTTE1Ni44MDMgMGgxLjcxMnYyMGgtMS43MTJWMFptNTYuMTY3LjkxaDEuNzEyVjE5LjA5aC0xLjcxMlYuOTA5Wk00MC4yMTIgNi44MTdoMS43MTJ2Ni44MThoLTEuNzEyVjYuODE4Wm0zMC42MzYgMGgxLjcxM3Y2LjgxOGgtMS43MTNWNi44MThabTI1LjUzIDBoMS43MTN2Ni44MThoLTEuNzEyVjYuODE4Wm0zMC42MzcgMGgxLjcxMnY2LjgxOGgtMS43MTJWNi44MThaTTc1Ljk1NSA1aDEuNzEydjkuNTQ2aC0xLjcxM1Y1Wm0xNS4zMTgtLjkwOWgxLjcxMnYxMS4zNjRoLTEuNzEyVjQuMDlaTTgxLjA2IDcuMjczaDEuNzEydjUuNDU0SDgxLjA2VjcuMjczWm01LjEwNS0uOTFoMS43MTN2Ny43MjhoLTEuNzEzVjYuMzY0Wm0tNTEuMDYtMi4yNzJoMS43MTJ2MTEuMzY0aC0xLjcxMlY0LjA5Wk0zMCA3LjI3M2gxLjcxMnY1LjQ1NEgzMFY3LjI3M1pNNDUuMzE4IDVoMS43MTJ2MTBoLTEuNzEyVjVabTIwLjQyNCAwaDEuNzEydjEwaC0xLjcxMlY1Wm0zNS43NDMgMGgxLjcxMnYxMC40NTVoLTEuNzEyVjVabTIwLjQyNCAwaDEuNzEydjEwaC0xLjcxMlY1Wm0tNzEuNDg1LS45MDloMS43MTJ2MTEuODE4aC0xLjcxMlY0LjA5MVptMTAuMjEyLS40NTVoMS43MTJ2MTMuMTgyaC0xLjcxMlYzLjYzNlptNDUuOTU1LS40NTRoMS43MTJ2MTMuNjM2aC0xLjcxMlYzLjE4MlptMTAuMjEyIDBoMS43MTJ2MTMuNjM2aC0xLjcxMlYzLjE4MlpNNTUuNTMgMGgxLjcxMnYyMEg1NS41M1YwWm01Ni4xNjcuOTFoMS43MTJWMTkuMDloLTEuNzEyVi45MDlaIiBmaWxsPSIjMDAwIiBmaWxsLW9wYWNpdHk9Ii4yIi8+PGRlZnM+PGZpbHRlciBpZD0iYSIgeD0iLTQuNDQ0IiB5PSItNC40NDQiIHdpZHRoPSIyOC44ODkiIGhlaWdodD0iMjguODg5IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+PGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz48ZmVHYXVzc2lhbkJsdXIgaW49IkJhY2tncm91bmRJbWFnZUZpeCIgc3RkRGV2aWF0aW9uPSIyLjIyMiIvPjxmZUNvbXBvc2l0ZSBpbjI9IlNvdXJjZUFscGhhIiBvcGVyYXRvcj0iaW4iIHJlc3VsdD0iZWZmZWN0MV9iYWNrZ3JvdW5kQmx1cl8xMjAwXzQzIi8+PGZlQmxlbmQgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0MV9iYWNrZ3JvdW5kQmx1cl8xMjAwXzQzIiByZXN1bHQ9InNoYXBlIi8+PC9maWx0ZXI+PC9kZWZzPjwvc3ZnPg==",le=t(21798),ta=t(22462),oa=function(f){var p=f.data,d=(0,m.useModel)("useTelegram"),o=d.telegramDataString,s=d.miniAppUtils,l=d.telegramWebApp,I=d.telegramAuthType,Q=(0,m.useModel)("useAccess"),W=Q.accessToken,H=Q.accessTokenExpire,se=(0,m.useModel)("useWallet"),G=se.setWalletModalVisible,K=(0,m.useModel)("useSetting"),g=K.character,Y=i.useState(!1),X=D()(Y,2),r=X[0],O=X[1],pe=i.useState(!1),U=D()(pe,2),J=U[0],re=U[1],T=i.useState(!1),ce=D()(T,2),N=ce[0],_=ce[1],b=i.useState(!1),A=D()(b,2),de=A[0],me=A[1],ue=i.useState(!1),q=D()(ue,2),ee=q[0],ae=q[1],ve=i.useState(),ne=D()(ve,2),he=ne[0],te=ne[1],S=(0,i.createRef)(),w=(0,i.useRef)(null);return(0,e.jsxs)("div",{className:c.aiPopContainer,onClick:function(){var C;if(S!=null&&S.current&&S!==null&&S!==void 0&&(C=S.current)!==null&&C!==void 0&&C.paused){var P;S==null||(P=S.current)===null||P===void 0||P.play()}else{var n;S==null||(n=S.current)===null||n===void 0||n.pause()}},children:[(0,e.jsx)("div",{className:c.aiPopWrapper,ref:w,children:p==null?void 0:p.map(function(a){var C;switch(a!=null&&a.action&&(w==null||(C=w.current)===null||C===void 0||(C=C.classList)===null||C===void 0||C.add(c.aiPopWrapperFull)),a==null?void 0:a.type){case"message":switch(a==null?void 0:a.action){case"connectWallet":return(0,e.jsxs)("div",{className:c.aiPopAction,children:[(0,e.jsx)(le.U,{className:c.aiPopText,components:{a:function(n){return(0,e.jsxs)("a",{onClick:function(F){o&&l&&(n!=null&&n.href)?s==null||s.openLink(n==null?void 0:n.href):window.open(n==null?void 0:n.href,"_blank")},target:"_blank",rel:"noreferrer",className:c.aiPopLink,children:["\u{1F517} ",n.children]})},li:"p",ol:"p",ul:"p"},children:a==null?void 0:a.data}),(0,e.jsx)("div",{className:c.aiPopButtons,children:(0,e.jsxs)(xe.ZP,{block:!0,type:"primary",size:"large",className:c.aiPopButton,onClick:function(){o&&l?s==null||s.openLink("".concat(B.fk===null||B.fk===void 0?void 0:B.fk.url,"/hub?access_token=").concat(W,"&access_token_expire=").concat(H,"&action=connectWallet&characterId=").concat(g==null?void 0:g.id,"&telegramDataString=").concat(encodeURIComponent(o),"&telegramAuthType=").concat(I)):G(!0),o&&l&&(l==null||l.close())},children:[(0,e.jsx)(je.PdK,{className:c.aiPopButtonIcon}),"Connect Wallet"]})})]},a==null?void 0:a.id);case"connectTwitter":return(0,e.jsxs)(i.Fragment,{children:[(0,e.jsxs)("div",{className:c.aiPopAction,children:[(0,e.jsx)(le.U,{className:c.aiPopText,components:{a:function(n){return(0,e.jsxs)("a",{onClick:function(F){o&&l&&(n!=null&&n.href)?s==null||s.openLink(n==null?void 0:n.href):window.open(n==null?void 0:n.href,"_blank")},target:"_blank",rel:"noreferrer",className:c.aiPopLink,children:["\u{1F517} ",n.children]})},li:"p",ol:"p",ul:"p"},children:a==null?void 0:a.data}),(0,e.jsx)("div",{className:c.aiPopButtons,children:(0,e.jsxs)(xe.ZP,{block:!0,type:"primary",size:"large",className:c.aiPopButton,onClick:function(){o&&l?s==null||s.openLink("".concat(B.fk===null||B.fk===void 0?void 0:B.fk.url,"/hub?access_token=").concat(W,"&access_token_expire=").concat(H,"&action=connectTwitter&characterId=").concat(g==null?void 0:g.id,"&telegramDataString=").concat(encodeURIComponent(o),"&telegramAuthType=").concat(I)):ae(!0),o&&l&&(l==null||l.close())},children:[(0,e.jsx)(je.Gh0,{className:c.aiPopButtonIcon}),"Login with Twitter"]})})]}),(0,e.jsx)(ta.Z,{visible:ee,setVisible:ae})]},a==null?void 0:a.id);case"buyPower":return(0,e.jsxs)(i.Fragment,{children:[(0,e.jsxs)("div",{className:c.aiPopAction,children:[(0,e.jsx)(le.U,{className:c.aiPopText,components:{a:function(n){return(0,e.jsxs)("a",{onClick:function(F){o&&l&&(n!=null&&n.href)?s==null||s.openLink(n==null?void 0:n.href):window.open(n==null?void 0:n.href,"_blank")},target:"_blank",rel:"noreferrer",className:c.aiPopLink,children:["\u{1F517} ",n.children]})},li:"p",ol:"p",ul:"p"},children:a==null?void 0:a.data}),(0,e.jsx)("div",{className:c.aiPopButtons,children:(0,e.jsx)(Ie.ZP,{theme:{algorithm:Ce.Z.defaultAlgorithm,token:{wireframe:!1,colorPrimary:ie.m.colorSecondary,borderRadius:ie.m.borderRadius,boxShadow:ie.m.boxShadow}},children:(0,e.jsx)(xe.ZP,{block:!0,type:"primary",size:"large",className:c.aiPopButtonDark,onClick:function(){o&&l?s==null||s.openLink("".concat(B.fk===null||B.fk===void 0?void 0:B.fk.url,"/hub?access_token=").concat(W,"&access_token_expire=").concat(H,"&action=buyPower&characterId=").concat(g==null?void 0:g.id,"&telegramDataString=").concat(encodeURIComponent(o),"&telegramAuthType=").concat(I)):O(!0),o&&l&&(l==null||l.close())},children:"Buy AIME Power"})})})]}),(0,e.jsx)(fe.Z,{visible:r,setVisible:O,transactionHash:he,setTransactionHash:te,mode:"buy"})]},a==null?void 0:a.id);case"sellPower":return(0,e.jsxs)(i.Fragment,{children:[(0,e.jsxs)("div",{className:c.aiPopAction,children:[(0,e.jsx)(le.U,{className:c.aiPopText,components:{a:function(n){return(0,e.jsxs)("a",{onClick:function(F){o&&l&&(n!=null&&n.href)?s==null||s.openLink(n==null?void 0:n.href):window.open(n==null?void 0:n.href,"_blank")},target:"_blank",rel:"noreferrer",className:c.aiPopLink,children:["\u{1F517} ",n.children]})},li:"p",ol:"p",ul:"p"},children:a==null?void 0:a.data}),(0,e.jsx)("div",{className:c.aiPopButtons,children:(0,e.jsx)(Ie.ZP,{theme:{algorithm:Ce.Z.defaultAlgorithm,token:{wireframe:!1,colorPrimary:ie.m.colorSecondary,borderRadius:ie.m.borderRadius,boxShadow:ie.m.boxShadow}},children:(0,e.jsx)(xe.ZP,{block:!0,type:"primary",size:"large",className:c.aiPopButtonDark,onClick:function(){o&&l?s==null||s.openLink("".concat(B.fk===null||B.fk===void 0?void 0:B.fk.url,"/hub?access_token=").concat(W,"&access_token_expire=").concat(H,"&action=sellPower&characterId=").concat(g==null?void 0:g.id,"&telegramDataString=").concat(encodeURIComponent(o),"&telegramAuthType=").concat(I)):re(!0),o&&l&&(l==null||l.close())},children:"Sell AIME Power"})})})]}),(0,e.jsx)(fe.Z,{visible:J,setVisible:re,transactionHash:he,setTransactionHash:te,mode:"sell"})]},a==null?void 0:a.id);case"shareLink":return(0,e.jsxs)(i.Fragment,{children:[(0,e.jsxs)("div",{className:c.aiPopAction,children:[(0,e.jsx)(le.U,{className:c.aiPopText,components:{a:function(n){return(0,e.jsxs)("a",{onClick:function(F){o&&l&&(n!=null&&n.href)?s==null||s.openLink(n==null?void 0:n.href):window.open(n==null?void 0:n.href,"_blank")},target:"_blank",rel:"noreferrer",className:c.aiPopLink,children:["\u{1F517} ",n.children]})},li:"p",ol:"p",ul:"p"},children:a==null?void 0:a.data}),(0,e.jsx)("div",{className:c.aiPopButtons,children:(0,e.jsx)(xe.ZP,{block:!0,type:"primary",size:"large",className:c.aiPopButton,onClick:function(){_(!0)},children:"Share"})})]}),(0,e.jsx)(Le.Z,{characterId:g==null?void 0:g.id,visible:N,setVisible:_})]},a==null?void 0:a.id);default:return(0,e.jsx)(le.U,{className:c.aiPopText,components:{a:function(n){return(0,e.jsxs)("a",{onClick:function(F){o&&l&&(n!=null&&n.href)?s==null||s.openLink(n==null?void 0:n.href):window.open(n==null?void 0:n.href,"_blank")},target:"_blank",rel:"noreferrer",className:c.aiPopLink,children:["\u{1F517} ",n.children]})},li:"p",ol:"p",ul:"p"},children:a==null?void 0:a.data},a==null?void 0:a.id)}case"data":return(0,e.jsxs)("div",{className:c.aiPopAudio,children:[(0,e.jsx)(Ee,{}),(0,e.jsx)("audio",{className:c.aiPopAudioPlayer,src:URL.createObjectURL(new Blob([a==null?void 0:a.data],{type:"audio/mp3"})),ref:S,children:(0,e.jsx)("source",{src:URL.createObjectURL(new Blob([a==null?void 0:a.data],{type:"audio/mp3"})),type:"audio/mp3"})})]},a==null?void 0:a.id)}})}),(0,e.jsx)("div",{className:c.aiPopWidget,children:(0,e.jsx)("div",{className:c.aiPopWidgetForward,children:(0,e.jsx)(je.ikO,{className:c.aiPopWidgetForwardIcon})})})]})},ia=oa,Me={mePopContainer:"mePopContainer___ECg8X",mePopWrapper:"mePopWrapper___riGvr",mePopText:"mePopText___YuIbQ",mePopLink:"mePopLink___Q5B7g",mePopTextIcon:"mePopTextIcon___gBYRe",mePopAudio:"mePopAudio___tW5SP",mePopAudioPlayer:"mePopAudioPlayer___AZYe2"},la=function(f){var p=f.data,d=(0,i.createRef)();return(0,e.jsx)("div",{className:Me.mePopContainer,onClick:function(){var s;if(d!=null&&d.current&&d!==null&&d!==void 0&&(s=d.current)!==null&&s!==void 0&&s.paused){var l;d==null||(l=d.current)===null||l===void 0||l.play()}else{var I;d==null||(I=d.current)===null||I===void 0||I.pause()}},children:(0,e.jsx)("div",{className:Me.mePopWrapper,children:p==null?void 0:p.map(function(o,s){switch(o==null?void 0:o.type){case"message":return(0,e.jsx)("div",{className:Me.mePopText,children:o==null?void 0:o.data},o==null?void 0:o.id);case"data":return(0,e.jsxs)("div",{className:Me.mePopAudio,children:[(0,e.jsx)(Ee,{}),(0,e.jsx)("audio",{className:Me.mePopAudioPlayer,src:URL.createObjectURL(new Blob([o==null?void 0:o.data],{type:"audio/mp3"})),ref:d,children:(0,e.jsx)("source",{src:URL.createObjectURL(new Blob([o==null?void 0:o.data],{type:"audio/mp3"})),type:"audio/mp3"})})]},o==null?void 0:o.id)}})})})},sa=la,$=t(20081),ra=t(701),ca=t(8193),da=t(60155),ua=t(77913),va=t(46393),ha=t(57632),De=t(28291),xa=function(){var f,p=(0,m.useModel)("useAccess"),d=p.accessToken,o=(0,m.useModel)("useChat"),s=o.messages,l=o.messageList,I=o.chatSession,Q=o.reconnect,W=o.clearChatContent,H=o.setMessageList,se=o.setMessages,G=(0,m.useModel)("useWebRTC"),K=G.audioQueue,g=G.setAudioPlayerRef,Y=(0,m.useModel)("useSetting"),X=Y.selectedSpeaker,r=Y.character,O=Y.setCharacter,pe=(0,m.useModel)("useView"),U=pe.viewport,J=(0,m.useModel)("useSocket"),re=J.handleChangeSocketUrl,T=J.handleCloseSocket,ce=(0,m.useModel)("useTelegram"),N=ce.miniAppBackButton,_=i.useRef(null),b=i.useRef(null),A=i.useRef(null),de=i.useState(!0),me=D()(de,2),ue=me[0],q=me[1],ee=i.useState(!1),ae=D()(ee,2),ve=ae[0],ne=ae[1],he=i.useState(!1),te=D()(he,2),S=te[0],w=te[1],a=ua.Z.parse(window.location.search);(0,i.useEffect)(function(){N&&(N==null||N.show(),N==null||N.on("click",function(){m.history.push("/")}))},[N]);var C=(0,i.useRef)(null),P=(0,i.useRef)(K);(0,i.useEffect)(function(){P.current=K},[K]),(0,i.useEffect)(function(){g(C)},[]);var n=(0,m.useParams)(),k=n.id;(0,i.useEffect)(function(){oe()(V()().mark(function u(){var M,R,j;return V()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(!(!d||!(a!=null&&a.session)||!r)){x.next=2;break}return x.abrupt("return");case 2:return x.next=4,(0,ye.Oq)(d,a==null?void 0:a.session);case 4:M=x.sent,R=M.response,j=M.data,(R==null?void 0:R.status)===200&&(j!=null&&j.length)&&(W(),j.map(function(h){var z=(0,ha.Z)().replace(/-/g,"");se(function(E){return[].concat(Ve()(E),[{id:z,type:De.C.MESSAGE,sender:(h==null?void 0:h.from)===(r==null?void 0:r.id)?"character":"user",data:h==null?void 0:h.data,timestamp:Date.now()}])}),H(function(E){var Ae=E.get("".concat(z,"/").concat((h==null?void 0:h.from)===(r==null?void 0:r.id)?"character":"user"))||[];return Ae.push({id:z,sender:(h==null?void 0:h.from)===(r==null?void 0:r.id)?"character":"user",type:De.C.MESSAGE,data:h==null?void 0:h.data,timestamp:Date.now()}),E.set("".concat(z,"/").concat((h==null?void 0:h.from)===(r==null?void 0:r.id)?"character":"user"),Ae),E})}));case 8:case"end":return x.stop()}},u)}))()},[a==null?void 0:a.session,d,r]),(0,i.useEffect)(function(){!d||!$.x.size||!k||O($.x.get(k)||{})},[k,d,$.x]),(0,i.useEffect)(function(){oe()(V()().mark(function u(){var M,R;return V()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(!Object.keys(r).length||!$.x.size||!(r!=null&&r.id)||!I)){v.next=2;break}return v.abrupt("return");case 2:if(!(!d||!$.x.size||!k)){v.next=5;break}return m.history.push("/"),v.abrupt("return");case 5:if($.x.get(k)){v.next=9;break}return m.history.push("/"),Te.ZP.error("Character not found"),v.abrupt("return");case 9:a!=null&&a.session||(W(),re({sessionId:(a==null?void 0:a.session)||(I==null||(M=I.get(r==null?void 0:r.id))===null||M===void 0?void 0:M.id),character:(R=$.x.get(k))!==null&&R!==void 0?R:{},accessToken:d,reconnect:Q}));case 10:case"end":return v.stop()}},u)}))()},[a==null?void 0:a.session,k,d,$.x,r,I]),(0,i.useEffect)(function(){var u;if(typeof((u=C.current)===null||u===void 0?void 0:u.setSinkId)=="function"){var M;(M=C.current)===null||M===void 0||M.setSinkId(X.values().next().value)}},[X]);var F=function(){T(),W(),O({})};return(0,i.useEffect)(function(){b.current&&(b.current.scrollTop=b.current.scrollHeight,b.current.addEventListener("scroll",function(){var u,M;w(((u=b.current)===null||u===void 0?void 0:u.scrollTop)!==((M=b.current)===null||M===void 0?void 0:M.scrollHeight))}))},[s,b.current]),(0,i.useEffect)(function(){var u=new ResizeObserver(function(M){if(!(!Array.isArray(M)||!M.length)){var R=Ze()(M),j;try{for(R.s();!(j=R.n()).done;){var v,x=j.value;_==null||(v=_.current)===null||v===void 0||v.setAttribute("style","height: calc(".concat(U.height,"px - ").concat(x.contentRect.height,"px)"))}}catch(h){R.e(h)}finally{R.f()}}});return A.current&&u.observe(A.current),function(){A.current&&u.unobserve(A.current)}},[U]),(0,e.jsxs)(ra.$,{children:[(0,e.jsxs)("div",{className:L.chatContainer,children:[(0,e.jsx)("audio",{ref:C,className:L.audioPlayer,children:(0,e.jsx)("source",{src:"",type:"audio/mp3"})}),(0,e.jsxs)("div",{className:L.chatWrapper,ref:_,children:[(0,e.jsxs)("div",{className:L.chatHeader,children:[(0,e.jsxs)("div",{className:L.chatHeaderButtons,children:[(0,e.jsx)("div",{className:L.chatHeaderLeft,children:(0,e.jsxs)("div",{className:L.chatHeaderHome,onClick:function(){F(),m.history.push("/")},children:[(0,e.jsx)(Ne.DaR,{className:L.chatHeaderHomeIcon}),(0,e.jsx)("span",{children:"Home"})]})}),(0,e.jsxs)("div",{className:L.chatHeaderRight,children:[(0,e.jsx)("div",{className:L.chatHeaderButton,onClick:function(){m.history.push("/chat/".concat(k,"/statistics"))},children:(0,e.jsx)(He.cST,{})}),(0,e.jsx)("div",{className:L.chatHeaderButton,children:(0,e.jsx)(ca.y5j,{})}),(0,e.jsx)("div",{className:L.chatHeaderButton,onClick:function(){ne(!0)},children:(0,e.jsx)(da.B0q,{})})]})]}),(0,e.jsx)("div",{className:L.chatHeaderAvatar,style:{height:S?"80px":"180px",width:S?"80px":"180px"},children:(0,e.jsx)(va.Z,{className:L.chatHeaderAvatarImg,src:r==null?void 0:r.avatar_url,fallback:t(41508),preview:!1})}),(0,e.jsx)("div",{className:L.chatHeaderName,children:r==null?void 0:r.name})]}),(0,e.jsx)("div",{className:L.chatContent,ref:b,children:!!l.size&&((f=Array.from(l==null?void 0:l.keys()))===null||f===void 0?void 0:f.map(function(u){return(0,e.jsxs)(i.Fragment,{children:[u.split("/")[1]==="character"&&(0,e.jsx)(ia,{data:l==null?void 0:l.get(u),"data-id":u},u),u.split("/")[1]==="user"&&(0,e.jsx)(sa,{data:l==null?void 0:l.get(u),"data-id":u},u)]},u)}))})]}),!(a!=null&&a.session)&&(0,e.jsx)(Ke,{isTextMode:ue,setIsTextMode:q,inputBoxContainer:A})]}),(0,e.jsx)(Le.Z,{characterId:r==null?void 0:r.id,visible:ve,setVisible:ne})]})},Ma=xa}}]);
